# ğŸ“† 2024-11-18

# ğŸ”” ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1 : FormData ë‹¤ë£¨ê¸°

<br/>

# ğŸš€ Today I Learned


ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê³¼ì •ì—ì„œ ì´ë¯¸ì§€ì™€ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ê¸° ìœ„í•´ FormDataë¥¼ ì‚¬ìš©í–ˆëŠ”ë° ì •í™•í•œ ì´í•´ ì—†ì´ FormDataë¥¼ ì‚¬ìš©í•˜ë ¤ë‹¤ ë³´ë‹ˆ ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ì›ì¸ì„ íŒŒì•…í•˜ê¸°ê°€ ì–´ë ¤ì› ë‹¤..

ê·¸ë˜ì„œ ì´ë²ˆ ê¸°íšŒì— ì™œ FormDataë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€, ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì„ í•´ì•¼í•˜ê³  ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ì „ë‹¬ë˜ëŠ”ì§€, ì„œë²„ì—ì„œëŠ” ì–´ë–»ê²Œ FormDataë¥¼ ì²˜ë¦¬ í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ì •ë¦¬í•´ë³´ë ¤ê³  í•œë‹¤.


## FormData


FormDataëŠ” HTML5 form íƒœê·¸ì˜ ë°ì´í„°ë¥¼ ë‹¤ë£¨ê±°ë‚˜ ë™ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” JS ë‚´ì¥ ê°ì²´ì´ë‹¤. ì£¼ë¡œ íŒŒì¼ ì—…ë¡œë“œí•  ë•Œ ì‚¬ìš©ëœë‹¤.

FormDataëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°–ëŠ”ë‹¤.

1. Key-Value í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•œë‹¤.
2. ë°ì´í„°ë¥¼ multipart/form-data í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œë‹¤.
3. ë‹¤ì–‘í•œ ë°ì´í„°(e.g. íŒŒì¼, í…ìŠ¤íŠ¸ ë°ì´í„°)ë¥¼ ë™ì‹œì— ì „ì†¡í•  ìˆ˜ ìˆë‹¤.


### HTML5 form íƒœê·¸ ëŒ€ì‹  FormDataë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?

```
ì´ë¯¸ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì¸ HTML5 formíƒœê·¸ê°€ ìˆëŠ”ë°, ì™œ êµ³ì´ FormDataë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œ? ë¼ëŠ” ì˜ë¬¸ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤. 

FormDataëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—¬ëŸ¬ ì¥ì ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 

1. HTML5 form íƒœê·¸ëŠ” ë°ì´í„°ë¥¼ ì „ì†¡í•  ë•Œ í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ëœë‹¤. ë°˜ë©´, FormDataëŠ” **ë¹„ë™ê¸° ìš”ì²­ì„ í†µí•´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ì•Šê³ ë„ ë°ì´í„°ë¥¼ ì „ì†¡**í•  ìˆ˜ ìˆë‹¤.

2. HTML5 form íƒœê·¸ëŠ” ì •ì ì¸ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ”ë° ì í•©í•˜ë‹¤. ë°˜ë©´, FormDataëŠ” **ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ì²˜ë¦¬(e.g. ë°ì´í„° ì „ì²˜ë¦¬)**í•  ìˆ˜ ìˆë‹¤.

3. FormDataëŠ” íŒŒì¼, í…ìŠ¤íŠ¸, Blob ê°ì²´ ë“± **ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì…ì„ ì „ì†¡**í•  ìˆ˜ ìˆë‹¤.
```

### multipart

FormDataëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ `multipart/form-data` í˜•ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œë‹¤. 

ì—¬ê¸°ì„œ multipartëŠ” **HTTP ìš”ì²­ ë³¸ë¬¸ì„ ì—¬ëŸ¬ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì „ì†¡í•˜ëŠ” ì¸ì½”ë”© ë°©ì‹**ì´ë‹¤. ì£¼ë¡œ í…ìŠ¤íŠ¸ ë°ì´í„°ì™€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°(e.g. ì´ë¯¸ì§€)ë¥¼ í•¨ê»˜ ì „ì†¡í•  ë•Œ ì‚¬ìš©í•œë‹¤.

ë‹¤ìŒì€ `multipart/form-data` íƒ€ì…ì˜ HTTP ìš”ì²­ ì˜ˆì‹œì´ë‹¤.


```
// ìš”ì²­ í—¤ë”
POST /upload HTTP/1.1
Host: localhost:3000
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary12345
Content-Length: 1234

// ìš”ì²­ ë³¸ë¬¸
------WebKitFormBoundary12345
Content-Disposition: form-data; name="data"; filename="blob"
Content-Type: application/json

{"title":"Sample Title","description":"Sample Description"}
------WebKitFormBoundary12345
Content-Disposition: form-data; name="file"; filename="example.jpg"
Content-Type: image/jpeg

(binary data of the image)
------WebKitFormBoundary12345--
```

multipart/form-data íƒ€ì…ì˜ HTTP ìš”ì²­ì€ **boundary ë¬¸ìì—´ì„ ê¸°ì¤€ìœ¼ë¡œ ìš”ì²­ ë³¸ë¬¸ì„ ë‚˜ëˆˆë‹¤**. ì´ë•Œ ë§ˆì§€ë§‰ boundary ëì— '--' ë¬¸ìì—´ì´ ë¶™ì–´ìˆì„ ê²½ìš° ìš”ì²­ ë³¸ë¬¸ì˜ ëì„ ë‚˜íƒ€ë‚¸ë‹¤.

boundaryëŠ” ë¸Œë¼ìš°ì €ê°€ ëœë¤ìœ¼ë¡œ ìƒì„±í•œ ê°’ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§„ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ê°€ ì „ì†¡ë˜ì—ˆì„ ë•Œ ê°ê°ì˜ key/value ìŒì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì—¬ê¸°ì„œ keyëŠ” ê° ë°ì´í„° ë¸”ë¡ ë‚´ë¶€ì˜ Content-Disposition í—¤ë”ì—ì„œ nameì´ê³ , valueëŠ” ë³¸ë¬¸ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.


## ì–´ë–»ê²Œ FormDataë¥¼ ë³´ë‚¼ê¹Œ?

```jsx
const title = document.querySelector("#title");
const content = document.querySelector("#content");

const file = document.querySelector("#file");
const button = document.querySelector("#submit");

const formData = new FormData();

const data = {
	'title': '',
	'content': ''
};

file.addEventListender('change', (e) => {
	const file = e.target.files[0];

	if (!file) {
		return;
	}

	formData.append('image', file);
});

const inputs = document.querySelectorAll('.input');
inputs.forEach(input => {
	input.addEventListener('input', (e) => {
		data[input.id] = e.target.value;
	})
});

button.addEventListener('click', async (e) => {
	formData.append('data', new Blob([JSON.stringify(data)], {
		type: 'application/json',
	});

	const response = await fetch('http://localhost:8080/api/posts', {
		method: POST,
		body: formData,
		credentials: 'include'
	}
});
```

ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ë°©ë²•ì€ ì•„ì£¼ ê°„ë‹¨í•˜ë‹¤. FormData ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°ì´í„°ë¥¼ ë‹´ì€ í›„ HTTP ìš”ì²­ ì‹œ bodyì— FormData ê°ì²´ë¥¼ ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.

ì—¬ê¸°ì„œ JSON ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ë˜ë©´ í•´ë‹¹ **ë°ì´í„° íƒ€ì…ì„ application/jsonìœ¼ë¡œ ëª…í™•í•˜ê²Œ ì •ì˜**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„œë²„ì—ì„œ MIME íƒ€ì…ì„ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ê³  ìš”ì²­ ë³¸ë¬¸ì„ íŒŒì‹±í•  ë•Œ **ë°ì´í„°ë¥¼ ì ì ˆí•˜ê²Œ ì²˜ë¦¬**í•  ìˆ˜ ìˆê²Œ ëœë‹¤. í•„ìˆ˜ ì‚¬í•­ì€ ì•„ë‹Œë“¯ í•˜ë‹¤.


## ì„œë²„ëŠ” ì–´ë–»ê²Œ  FormDataë¥¼ ì²˜ë¦¬í• ê¹Œ?

FormDataë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ expressì˜ multer ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•œë‹¤. multerë¥¼ ì‚¬ìš©í•˜ë©´ multipart ìš”ì²­ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

ì•ì„œ ë³´ì•˜ë“¯ì´, JSON ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡í–ˆê¸° ë•Œë¬¸ì— ì„œë²„ ì¸¡ì—ì„œëŠ” ë‘ ê°œì˜ íŒŒì¼ì„ ì „ë‹¬ë°›ì„ ê²ƒì´ë‹¤.
 
ê·¸ë ‡ê¸° ë•Œë¬¸ì— í•œ ë²ˆì— í•˜ë‚˜ì˜ íŒŒì¼ë§Œ ì²˜ë¦¬í•˜ëŠ” Multerì˜ single() ì„¤ì •ì„ í•˜ê²Œë˜ë©´ MulterError: Unexpected field ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

ì´ ê²½ìš°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ Multerì˜ fields()ì„¤ì •ì„ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ì™€ JSON ë°ì´í„°ë¥¼ ê°ê° ë‹¤ë£¨ì–´ì£¼ì–´ì•¼ í•œë‹¤.


```jsx
const express = require('express');
const multer = require('multer');
const app = express();
const uploader = multer({ ... });

app.post(
	"/api/posts",
	uploader.fields([
		{ name: "image" },
		{ name: "data" }
	]),
	(req, res) => {
		try {
            // JSON ë°ì´í„° 
            const blob = req.files.data ? req.files.data[0] : null;
            const data = blob ? JSON.parse(fs.readFileSync(blob.path, 'utf8')) : null;
            const {title, content} = data;

            // ì´ë¯¸ì§€
            let imageUrl;
            if (req.files.image) {
                imageUrl = path.join('...', req.files.image[0].filename);
            }
            
            ...

		} catch (e) {
			next(e);
		}	
	}
)
```

## Reference

https://amaran-th.github.io/%EC%A3%BC%EC%A0%80%EB%A6%AC%EC%A3%BC%EC%A0%80%EB%A6%AC/%5BHTTP%5D%20Multipart%20%EC%9A%94%EC%B2%AD/

https://inpa.tistory.com/entry/JS-%F0%9F%93%9A-FormData-%EC%A0%95%EB%A6%AC-fetch-api

<br/>

# ğŸ”¥ ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•

- FormDataì— ëŒ€í•´ì„œ í•™ìŠµ !

<br/>

# ğŸ—¨ï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 

- JSON ë°ì´í„°ë¥¼ ë” ì‰½ê³  ê°„í¸í•˜ê²Œ ë‹¤ë£° ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì„ ê²ƒ ê°™ë‹¤.


<!--
- ì˜¤ëŠ˜ì˜ í•™ìŠµ ê²½í—˜ì— ëŒ€í•œ ììœ ë¡œìš´ ìƒê°ì´ë‚˜ ëŠë‚€ ì ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
- ì„±ê³µì ì¸ ì , ê°œì„ í•´ì•¼ í•  ì , ìƒˆë¡­ê²Œ ì‹œë„í•˜ê³  ì‹¶ì€ ë°©ë²• ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.-->

