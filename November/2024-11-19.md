# ğŸ“† 2024-11-19

# ğŸ”” ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1 : express-session

<br/>

# ğŸš€ Today I Learned


## ì„¸ì…˜(Session)

ì„¸ì…˜ì€ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ì¼ë ¨ì˜ ìš”ì²­ë“¤ì„ **ë™ì¼í•œ ì‚¬ìš©ìë¡œ ì¸ì‹í•˜ê³  ìƒíƒœë¥¼ ìœ ì§€**í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.

### ì„¸ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 


ì™œ ì¼ë ¨ì˜ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë™ì¼í•œ ì‚¬ìš©ìë¡œ ì¸ì‹í•˜ê³  ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í• ê¹Œ? ë¼ëŠ” ì˜ë¬¸ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤. 

ì´ëŠ” ë§ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ì ì¸ì¦, ì¥ë°”êµ¬ë‹ˆ ì²˜ëŸ¼ **ì´ì „ ìš”ì²­ì˜ ì •ë³´ê°€ ìœ ì§€**ë˜ì–´ì•¼ í•˜ëŠ” ê¸°ëŠ¥ë“¤ì„ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ¬ë‚˜, HTTPëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Stateless, Connectionlsesí•œ íŠ¹ì„±ì„ ê°–ê¸° ë•Œë¬¸ì— **ê° ìš”ì²­ì— ëŒ€í•´ ì‘ë‹µì„ ì™„ë£Œí•˜ë©´ ì—°ê²°ì´ ëŠì–´ì§ˆ ë¿ë§Œ ì•„ë‹ˆë¼ ì´ì „ ìš”ì²­ì˜ ì •ë³´ë¥¼ ê¸°ì–µí•˜ì§€ ì•ŠëŠ”ë‹¤**.

ì´ë•Œ ì„¸ì…˜ê³¼ ì„¸ì…˜ ì¿ í‚¤ë¥¼ í™œìš©í•˜ë©´ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì— ìƒíƒœë¥¼ ìœ ì§€í•  ìˆ˜ ìˆê²Œëœë‹¤.

![Page6](https://github.com/user-attachments/assets/ffd4f190-da13-41b2-a5e6-fe03ba601e8c)

### ë™ì‘ ìˆœì„œ

í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ í•˜ëŠ” ìƒí™©ìœ¼ë¡œ ê°€ì •í–ˆì„ ë•Œ ì„¸ì…˜ì˜ ëŒ€ëµì ì¸ ë™ì‘ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

**1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­**

ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê³  ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ í•œë‹¤. 

**2. ì„œë²„ì—ì„œ ì„¸ì…˜ ìƒì„±** 

ì„œë²„ëŠ” ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ì¸ì¦ì— ì„±ê³µí•˜ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•œë‹¤. ì´ë•Œ ìƒì„±ëœ ì„¸ì…˜ì— ê³ ìœ í•œ ì„¸ì…˜ IDê°€ ë¶€ì—¬ëœë‹¤.

**3. ì„¸ì…˜ ID ì „ë‹¬**

ì„œë²„ëŠ” ì„¸ì…˜ IDë¥¼ ì¿ í‚¤ì— ì €ì¥í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•œë‹¤.

**4. ì´í›„ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­**

í´ë¼ì´ì–¸íŠ¸ê°€ ìƒˆë¡œìš´ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, ì„¸ì…˜ IDê°€ ì €ì¥ëœ ì¿ í‚¤ë¥¼ í•¨ê»˜ ì „ì†¡í•œë‹¤.

**5. ì„œë²„ì—ì„œ ì„¸ì…˜ ID í™•ì¸**

ì„œë²„ëŠ” ì „ë‹¬ë°›ì€ ì„¸ì…˜ IDë¡œ ì„¸ì…˜ì„ ì¡°íšŒí•˜ê³  í•´ë‹¹ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•œë‹¤. 


## express-session


express-sessionì€ Express.jsì—ì„œ ì‚¬ìš©ë˜ëŠ” **ì„¸ì…˜ ê´€ë¦¬ ë¯¸ë“¤ì›¨ì–´**ì´ë‹¤. express-sessionì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

1. ì„¸ì…˜ ë°ì´í„° ì €ì¥
2. ì„¸ì…˜ ID ë¶€ì—¬
3. ì„¸ì…˜ ì˜µì…˜ ì„¤ì • (e.g. ì¿ í‚¤, ì„¸ì…˜ ì €ì¥ ë°©ì‹)
4. ì„¸ì…˜ ë°ì´í„° ì•”í˜¸í™”

1.5.0 ë²„ì „ ì´í›„ë¡œ cookie-parser ë¯¸ë“¤ì›¨ì–´ê°€ ì—†ì´ë„ ë™ì‘í•  ìˆ˜ ìˆê²Œë˜ì—ˆë‹¤ê³  í•œë‹¤.

express-sessionì„ ì‚¬ìš©í•  ë•Œ ì„¸ì…˜ ì €ì¥ì†Œë¡œ MemoryStoreë¥¼ ì“¸ ê²½ìš° ê°œë°œ ë‹¨ê³„ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì„¤ê³„ ìì²´ê°€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ê³ ë ¤í•˜ì§€ ì•Šê³  ì„¤ê³„ë˜ì—ˆê¸° ë•Œë¬¸ì— ë§ì€ ìƒí™©ì—ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ìˆë‹¤ê³  í•œë‹¤.


```jsx
const express = require('express');
const session = require('express-session');

const app = express();

app.use(session({
	secret: 'secret key', // ì„¸ì…˜ ë°ì´í„° ì•”í˜¸í™”ë¥¼ ìœ„í•œ í‚¤ (í•„ìˆ˜ ì˜µì…˜)
	resave: false, // ì„¸ì…˜ì— ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ë„ ì €ì¥ (ê¸°ë³¸ : true)
	saveUninitialized: false, // ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ì„¸ì…˜ì´ë¼ë„ ì €ì¥ (ê¸°ë³¸ : true)
	cookie: {
		httpOnly: true, // JSë¡œ ì¿ í‚¤ ì ‘ê·¼ ë°©ì§€
		maxAge: 7 * 24 * 60 * 60 * 1000 // ì¿ í‚¤ ë§Œë£Œ ì‹œê°„
		secure: false // HTTPS ì˜µì…˜ 
	}
}));
```

## PM2 start â€”watch ì˜µì…˜ ì£¼ì˜ì 


í”„ë¡œì íŠ¸ ë‚´ì— ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§ˆë‹¤ ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ pm2 start server.js --watch ëª…ë ¹ì–´ë¡œ API ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ìˆì—ˆë‹¤.

ê·¸ëŸ°ë°, íšŒì› ì •ë³´ë¥¼ ìˆ˜ì •í•œë‹¤ë˜ì§€ ê²Œì‹œê¸€ì„ ì‘ì„±í•œë‹¤ë˜ì§€ íŠ¹ì • APIë¥¼ í˜¸ì¶œí•˜ê³  ë‚˜ë©´ ì„¸ì…˜ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” APIë“¤ì˜ ê³µí†µì ì´ í”„ë¡œì íŠ¸ ë‚´ì— ë°ì´í„°ë¥¼ ìƒì„±í•œë‹¤ëŠ” ê²ƒì´ì—ˆê³  ì´ë¡œ ì¸í•´ ì„œë²„ê°€ ì¬ì‹œì‘ë˜ë©´ì„œ ì„¸ì…˜ ë°ì´í„°ê°€ ì‚¬ë¼ì§„ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ íŠ¹ì • íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ì— ëŒ€í•œ ë³€ê²½ì‚¬í•­ ì¶”ì ì„ ë§‰ì•„ì£¼ì–´ì•¼ í•œë‹¤.


```jsx
// ecosystem.config.js
module.exports = {
    apps: [
        {
            name: 'my-server', // ì•± ì´ë¦„
            script: './server.js', // ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸
            watch: true, // ë³€ê²½ ê°ì§€ í™œì„±í™”
            ignore_watch: [ // ê°ì§€ ì œì™¸ íŒŒì¼/í´ë”
                'node_modules',
                'logs', // ë¡œê·¸ ë””ë ‰í† ë¦¬ ì œì™¸
                '*.log', // íŠ¹ì • í™•ì¥ì ì œì™¸
                'tmp', // ì„ì‹œ íŒŒì¼ ë””ë ‰í† ë¦¬ ì œì™¸
                'db'
            ],
            env: {
                NODE_ENV: 'development',
            },
            env_production: {
                NODE_ENV: 'production',
            }
        }
    ]
};

>> pm2 reload ecosystem.config.js
```

## Reference

https://fierycoding.tistory.com/36

https://expressjs.com/en/resources/middleware/session.html

<br/>

# ğŸ”¥ ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•

- express-sessionì— ëŒ€í•´ì„œ í•™ìŠµ!

<br/>

# ğŸ—¨ï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 

- ì–´ë µë‹¤ ~


<!--
- ì˜¤ëŠ˜ì˜ í•™ìŠµ ê²½í—˜ì— ëŒ€í•œ ììœ ë¡œìš´ ìƒê°ì´ë‚˜ ëŠë‚€ ì ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
- ì„±ê³µì ì¸ ì , ê°œì„ í•´ì•¼ í•  ì , ìƒˆë¡­ê²Œ ì‹œë„í•˜ê³  ì‹¶ì€ ë°©ë²• ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.-->

