# ğŸ“† 2024-11-20

# ğŸ”” ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1 : ìŠ¤ìº”(SCAN) ì¢…ë¥˜ì™€ EXPLAIN

<br/>

# ğŸš€ Today I Learned


## ìŠ¤ìº” (Scan)


ìŠ¤ìº”ì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ **íŠ¹ì • ë°ì´í„°ë¥¼ ì°¾ê¸° ìœ„í•´ í…Œì´ë¸”ì´ë‚˜ ì¸ë±ìŠ¤ë¥¼ íƒìƒ‰í•˜ëŠ” ê³¼ì •**ì´ë‹¤. 

ìŠ¤ìº”ì€ **ì¿¼ë¦¬ ì„±ëŠ¥ì— ì§ì ‘ì ì¸ ì˜í–¥**ì„ ì£¼ê¸° ë•Œë¬¸ì— ê° ìŠ¤ìº” ë°©ì‹ì„ ì´í•´í•˜ëŠ” ê²ƒê³¼ ì‹¤í–‰ ê³„íšì„ ë¶„ì„í•œ í›„ ì´ë¥¼ ìµœì í™”í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì‹¤í–‰ ê³„íšì€ ì–´ë–»ê²Œ í™•ì¸í•  ìˆ˜ ìˆì„ê¹Œ?

## EXPLAIN


EXPLAIN í‚¤ì›Œë“œëŠ” Maria DBì—ì„œ **ì¿¼ë¦¬ì˜ ì‹¤í–‰ ê³„íšì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´**ì´ë‹¤. ì‹¤í–‰ ê³„íšë§Œ ì œê³µí•  ë¿, ì¿¼ë¦¬ê°€ ì‹¤ì œë¡œ ì‹¤í–‰ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

ì´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ê°€ íŠ¹ì • ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œì˜ **ìŠ¤ìº” ì¢…ë¥˜ì™€ ì¿¼ë¦¬ ì„±ëŠ¥ì„ ë¶„ì„**í•  ìˆ˜ ìˆë‹¤. 


### ì‚¬ìš©ë²•


EXPLAN í‚¤ì›Œë“œì˜ ì‚¬ìš©ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ì‹¤í–‰í•˜ë ¤ëŠ” ì¿¼ë¦¬ë¬¸ ì•ì— EXPLAIN í‚¤ì›Œë“œë¥¼ ë¶™í˜€ì£¼ë©´ ëœë‹¤.

ì´ë•Œ ì¶œë ¥ í˜•ì‹ì„ JSONìœ¼ë¡œ ì„¤ì •í• ìˆ˜ë„ ìˆë‹¤.


```sql
EXPLAIN SELECT * FROM STUDENTS;
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------+
|  1 | SIMPLE      | students | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |   100.00 | NULL  |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------+

EXPLAIN FORMAT=JSON SELECT * FROM STUDENTS;
{
  "query_block": {
    "select_id": 1,
    "cost_info": {
      "query_cost": "1.25"
    },
    "table": {
      "table_name": "students",
      "access_type": "ALL", // ìŠ¤ìº” ë°©ì‹
      "rows_examined_per_scan": 10,
      "rows_produced_per_join": 10,
      "filtered": "100.00",
      "cost_info": {
        "read_cost": "0.25",
        "eval_cost": "1.00",
        "prefix_cost": "1.25",
        "data_read_per_join": "8K"
      },
      "used_columns": [
        "student_id",
        "name",
        "age",
        "grade",
        "major",
        "gpa",
        "city"
      ]
    }
  }
}
```

EXPLAIN ëª…ë ¹ì–´ë¡œ ì¶œë ¥ëœ ì‹¤í–‰ ê³„íš í…Œì´ë¸”ì˜ ì£¼ìš” ì»¬ëŸ¼ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

**[id]**

- ì¿¼ë¦¬ ì‹¤í–‰ ìˆœì„œ

**[select_type]**

- ì¿¼ë¦¬ì˜ ìœ í˜•
	- SIMPLE : ì„œë¸Œì¿¼ë¦¬ê°€ ì—†ëŠ” ë‹¨ìˆœ SELECT ì¿¼ë¦¬
	- PRIMARY : ìµœìƒìœ„ ì¿¼ë¦¬
	- SUBQUERY : ì„œë¸Œ ì¿¼ë¦¬

**[type]**

- ë°ì´í„° ìŠ¤ìº” ë°©ì‹ (ì„±ëŠ¥ì´ ì¢‹ì€ ìˆœì„œë¡œ ìœ„ì—ì„œ ë¶€í„° ë‚˜ì—´)
	- const : ìƒìˆ˜ ê°’ìœ¼ë¡œ ì¡°íšŒ
	- eq_ref :  ì¡°ì¸ì—ì„œ ê³ ìœ  í‚¤ë‚˜ ê¸°ë³¸ í‚¤ë¡œ ì¡°íšŒ
	- ref : ì¡°ì¸ì—ì„œ ë¹„ê³ ìœ  ì¸ë±ìŠ¤ë¥¼ í†µí•´ ì¡°íšŒ
	- range : Index Range Scan, ì¸ë±ìŠ¤ ë²”ìœ„ë¥¼ ìŠ¤ìº”
	- index : Index Full Scan, ì¸ë±ìŠ¤ ì „ì²´ë¥¼ ìŠ¤ìº”
	- ALL : Full Table Scan, í…Œì´ë¸” ì „ì²´ë¥¼ ìŠ¤ìº”

**[key]**

- ì‹¤ì œë¡œ ì‚¬ìš©ëœ ì¸ë±ìŠ¤

**[rows]**

- ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì½ì–´ì•¼ í•˜ëŠ” í–‰ì„ ì˜ˆì¸¡í•œ ìˆ˜ 


## ìŠ¤ìº”ì˜ ì¢…ë¥˜

![1](https://github.com/user-attachments/assets/43e7c3b9-ee87-4eac-ab6c-e55b79f46ebd)


Maria DBì—ì„œ ìŠ¤ìº”ì˜ ì¢…ë¥˜ëŠ” í¬ê²Œ í…Œì´ë¸” ìŠ¤ìº”ê³¼ ì¸ë±ìŠ¤ ìŠ¤ìº”ìœ¼ë¡œ ë‚˜ëˆ ì§„ë‹¤. ë‘ ìŠ¤ìº” ë°©ì‹ì€ ë§ ê·¸ëŒ€ë¡œ **ì¸ë±ìŠ¤ ì‚¬ìš© ì—¬ë¶€ì˜ ì°¨ì´**ê°€ ìˆë‹¤.


```sql
CREATE TABLE students (
    student_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT NOT NULL,
    grade VARCHAR(10) NOT NULL,
    city VARCHAR(100) NOT NULL,
    gpa FLOAT NOT NULL,
    INDEX (city),         -- ë‹¨ì¼ ì»¬ëŸ¼ ì¸ë±ìŠ¤
    INDEX (age, grade),   -- ë©€í‹° ì»¬ëŸ¼ ì¸ë±ìŠ¤
);
```


ìœ„ì™€ ê°™ì€ í…Œì´ë¸”ì´ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ ê° ìŠ¤ìº” ë°©ì‹ì— ë”°ë¥¸ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  EXPLAIN í‚¤ì›Œë“œë¡œ ì‹¤í–‰ ê³„íšì„ í™•ì¸í•´ë³¸ë‹¤. 


### Full Table Scan

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkOvBP%2FbtsE0IrzdXT%2FAWSrH1DEeUOHgwIkUZwKFk%2Fimg.png)

Full Table Scanì€ **í…Œì´ë¸” ì „ì²´ ë°ì´í„°ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ íƒìƒ‰í•˜ëŠ” ìŠ¤ìº” ë°©ì‹**ì´ë‹¤. ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©° ì¡°ê±´ì´ ìˆì„ ê²½ìš° ë°ì´í„°ë¥¼ ì½ê³ ë‚œ ë’¤ì— í•„í„°ë§í•œë‹¤.

ë°ì´í„°ì˜ ì–‘ì´ ì ê±°ë‚˜ ì¸ë±ìŠ¤ê°€ ì—†ëŠ” í…Œì´ë¸”ì¸ ê²½ìš° ì„±ëŠ¥ ë¬¸ì œê°€ ì—†ìœ¼ë‚˜, ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œëŠ” ê°€ì¥ ì•ˆì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì¸ë‹¤.


```sql
EXPLAIN SELECT * FROM STUDENTS WHERE gpa > 3.0;

+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | students | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |    33.33 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
```

### Index Full Scan

<div style="display: flex; justify-content: center;">
  <img src = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FztJV1%2FbtsE0hgGFHf%2FKxF0HKkn02iJ7LKzU0f4Bk%2Fimg.png" width = "600" height = "300" >  
</div>

Index Full Scanì€ **ì¸ë±ìŠ¤ ì „ì²´ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ íƒìƒ‰í•˜ëŠ” ìŠ¤ìº” ë°©ì‹**ì´ë‹¤. ì£¼ë¡œ ì¿¼ë¦¬ê°€ WHERE ì¡°ê±´ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìš”ì²­í•˜ëŠ” ë°ì´í„°ê°€ ì¸ë±ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ì¼ ë•Œ ì‚¬ìš©ëœë‹¤.

í…Œì´ë¸” ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šê³  ì¸ë±ìŠ¤ë§Œì„ ì½ê¸° ë•Œë¬¸ì— Full Table Scan ë³´ë‹¤ Disk I/Oê°€ ì¤„ì–´ë“¤ì–´ ì„±ëŠ¥ì´ ë” ì¢‹ë‹¤.


```sql
EXPLAIN SELECT city FROM STUDENTS;

+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys | key      | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | students | NULL       | index | NULL          | idx_city | 202     | NULL |   10 |   100.00 | Using index |
+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
```

### Index Range Scan

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcixL5u%2FbtsEWzQDBq5%2F401a1PmhbUTsO6ywZ40XF0%2Fimg.png"> 

Index Range Scanì€ **íŠ¹ì • ë²”ìœ„ì˜ ì¸ë±ìŠ¤ë¥¼ ìŠ¤ìº”í•˜ê³  ì´ì— ëŒ€ì‘í•˜ëŠ” ë ˆì½”ë“œë“¤ì„ ì½ëŠ” ìŠ¤ìº” ë°©ì‹**ì´ë‹¤. 

**ë²”ìœ„ ì¡°ê±´(e.g. BETWEEN, <, >, IN)** ì´ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©ë  ë•Œ ìˆ˜í–‰ëœë‹¤.

Index Full Scanê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ë±ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ë§Œìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ ë•Œ í…Œì´ë¸” ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ê³¼ì •ì€ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

```sql
EXPLAIN SELECT * FROM STUDENTS WHERE age BETWEEN 20 AND 22;
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+-----------------------+
| id | select_type | table    | partitions | type  | possible_keys | key           | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | students | NULL       | range | idx_age_grade | idx_age_grade | 4       | NULL |    5 |   100.00 | Using index condition |
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+-----------------------+
```

### Loose Index Scan

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbuhWSf%2FbtsE2Blo8cp%2Fyxl5kZ6PVUHNa7rWZTsoK1%2Fimg.png">

Loose Index Scanì€ **ì¸ë±ìŠ¤ì—ì„œ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒì ìœ¼ë¡œ ìŠ¤ìº”í•˜ê³  ì´ì— ëŒ€ì‘í•˜ëŠ” ë ˆì½”ë“œë“¤ì„ ì½ëŠ” ìŠ¤ìº” ë°©ì‹**ì´ë‹¤.

ì£¼ë¡œ GROUP BYë‚˜ DISTINCT í‚¤ì›Œë“œê°€ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©ë  ë•Œ ìˆ˜í–‰ëœë‹¤.

```sql
EXPLAIN SELECT city, COUNT(city) FROM STUDENTS GROUP BY city;
+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type  | possible_keys | key      | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | students | NULL       | index | idx_city      | idx_city | 202     | NULL |   10 |   100.00 | Using index |
+----+-------------+----------+------------+-------+---------------+----------+---------+------+------+----------+-------------+
```

### Index Skip Scan

![image](https://github.com/user-attachments/assets/d994532f-b13f-4fb9-9811-635afb3b1dc1)

ì¼ë°˜ì ìœ¼ë¡œ ë©€í‹° ì»¬ëŸ¼ ì¸ë±ìŠ¤ì˜ ì²« ë²ˆì§¸ ì»¬ëŸ¼ì´ ì¡°ê±´ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— Full Table Scanìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.

ê·¸ëŸ¬ë‚˜, Index Skip Scanì€ **ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ë§Œì¡±í•˜ë©´ì„œ ë©€í‹° ì»¬ëŸ¼ ì¸ë±ìŠ¤ì—ì„œ ì²« ë²ˆì§¸ ì»¬ëŸ¼ì´ ì•„ë‹Œ í›„ì† ì»¬ëŸ¼ì„ ì¡°ê±´ì— ì‚¬ìš©í–ˆì„ ë•Œ ì‚¬ìš©ë˜ëŠ” ìŠ¤ìº” ë°©ì‹**ì´ë‹¤.

A ì»¬ëŸ¼, B ì»¬ëŸ¼ ìˆœìœ¼ë¡œ ë©€í‹° ì»¬ëŸ¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í–ˆë‹¤ë©´ ì¼ë°˜ì ìœ¼ë¡œ A ì»¬ëŸ¼ì— ëŒ€í•´ ë¨¼ì € ì •ë ¬ì„ ìˆ˜í–‰í•œ ë‹¤ìŒ Bì— ëŒ€í•´ ì •ë ¬ì„ ìˆ˜í–‰í•œë‹¤.


```sql
EXPLAIN SELECT * FROM STUDENTS WHERE grade='A';
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | students | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   10 |    10.00 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+

EXPLAIN SELECT age, gender FROM STUDENTS WHERE grade='A';
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+--------------------------+
| id | select_type | table    | partitions | type  | possible_keys | key           | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | students | NULL       | index | idx_age_grade | idx_age_grade | 206     | NULL |   10 |    10.00 | Using where; Using index |
+----+-------------+----------+------------+-------+---------------+---------------+---------+------+------+----------+--------------------------+
```

## Reference

https://jofestudio.tistory.com/127

<br/>

# ğŸ”¥ ì˜¤ëŠ˜ì˜ ë„ì „ ê³¼ì œì™€ í•´ê²° ë°©ë²•

- SCANì— ëŒ€í•´ì„œ í•™ìŠµ !

<br/>

# ğŸ—¨ï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 

- DB ì–´ë µë‹¤ ~


<!--
- ì˜¤ëŠ˜ì˜ í•™ìŠµ ê²½í—˜ì— ëŒ€í•œ ììœ ë¡œìš´ ìƒê°ì´ë‚˜ ëŠë‚€ ì ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
- ì„±ê³µì ì¸ ì , ê°œì„ í•´ì•¼ í•  ì , ìƒˆë¡­ê²Œ ì‹œë„í•˜ê³  ì‹¶ì€ ë°©ë²• ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.-->

